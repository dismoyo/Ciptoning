// ===================================================================================
// Author        : System
// Created date  : 18 Mar 2016 00:00:00
// Description   : DataService partial class.
//
// Modified date :
// Modified by   :
// Comments      :
//
// NOTE: This file is initially generated by system and can be modified following
//       the requirement.
// ===================================================================================

using Dismoyo.Ciptoning.Data;
using System;
using System.Data;
using System.Data.Services;
using System.Data.Services.Providers;
using System.Linq;
using System.Linq.Expressions;
using System.ServiceModel.Web;

namespace Dismoyo.Ciptoning.Web.Services
{

    public partial class DataService : EntityFrameworkDataService<StoreFunctionsDataContext>, IServiceProvider
    {

        #region Methods

        [QueryInterceptor("vCustomers")]
        public Expression<Func<vCustomer, bool>> OnQueryvCustomers()
        {
            return (p => !p.IsDeleted);
        }

        [ChangeInterceptor("vCustomers")]
        public void OnChangevCustomers(vCustomer data, UpdateOperations operations)
        {
            var dataProvider = DataConfiguration.GetDefaultDataProvider<IvCustomerDataProvider>();

            switch (operations)
            {
                case UpdateOperations.Add:
                    using (var transaction = DefaultDataContext.DataContext.Database.BeginTransaction())
                    {
                        try
                        {
                            var serverData = (data.ID.Equals(Guid.Empty)) ? null :
                                dataProvider.GetData(data.ID);

                            if (serverData == null)
                                dataProvider.InsertData(data, true);
                            else
                                dataProvider.UpdateData(data, true);

                            DefaultDataContext.DataContext.SaveChanges();
                            transaction.Commit();
                        }
                        catch (Exception ex)
                        {
                            transaction.Rollback();
                            throw ex;
                        }
                    }

                    operations = UpdateOperations.None;
                    break;
                case UpdateOperations.Change:
                    using (var transaction = DefaultDataContext.DataContext.Database.BeginTransaction())
                    {
                        try
                        {
                            dataProvider.UpdateData(data, true);
                            DefaultDataContext.DataContext.SaveChanges();
                            transaction.Commit();
                        }
                        catch (Exception ex)
                        {
                            transaction.Rollback();
                            throw ex;
                        }
                    }

                    operations = UpdateOperations.None;
                    break;
                case UpdateOperations.Delete:
                    using (var transaction = DefaultDataContext.DataContext.Database.BeginTransaction())
                    {
                        try
                        {
                            dataProvider.DeleteData(data, true);
                            DefaultDataContext.DataContext.SaveChanges();
                            transaction.Commit();
                        }
                        catch (Exception ex)
                        {
                            transaction.Rollback();
                            throw ex;
                        }
                    }

                    operations = UpdateOperations.None;
                    break;
            }

            if (operations == UpdateOperations.None)
                CancelChanges();
        }

        #endregion

        #region Custom Methods
        
        [WebGet]
        public IQueryable<vCustomer> fCustomers()
        {
            return CurrentDataSource.fCustomer(
                (Guid?)GetQueryFilterParameterValue("ID"),
                (string)GetQueryFilterParameterValue("Code"),
                (string)GetQueryFilterParameterValue("Name"),
                (Guid?)GetQueryFilterParameterValue("SalesmanID"),
                (string)GetQueryFilterParameterValue("SalesmanCode"),
                (string)GetQueryFilterParameterValue("SalesmanName"),
                (Guid?)GetQueryFilterParameterValue("WarehouseID"),
                (string)GetQueryFilterParameterValue("WarehouseCode"),
                (string)GetQueryFilterParameterValue("WarehouseName"),
                (Guid?)GetQueryFilterParameterValue("SiteID"),
                (string)GetQueryFilterParameterValue("SiteCode"),
                (string)GetQueryFilterParameterValue("SiteName"),
                (int?)GetQueryFilterParameterValue("CompanyID"),
                (string)GetQueryFilterParameterValue("CompanyCode"),
                (string)GetQueryFilterParameterValue("CompanyName"),
                (int?)GetQueryFilterParameterValue("AreaID"),
                (string)GetQueryFilterParameterValue("AreaCode"),
                (string)GetQueryFilterParameterValue("AreaName"),
                (int?)GetQueryFilterParameterValue("RegionID"),
                (string)GetQueryFilterParameterValue("RegionCode"),
                (string)GetQueryFilterParameterValue("RegionName"),
                (int?)GetQueryFilterParameterValue("TerritoryID"),
                (string)GetQueryFilterParameterValue("TerritoryCode"),
                (string)GetQueryFilterParameterValue("TerritoryName"),
                (int?)GetQueryFilterParameterValue("SiteDistributionTypeID"),
                (int?)GetQueryFilterParameterValue("WarehouseTypeID"),
                (int?)GetQueryFilterParameterValue("SalesmanGroupID"),
                (int?)GetQueryFilterParameterValue("SalesmanCategoryID"),
                (int?)GetQueryFilterParameterValue("SalesmanStatusID"),
                (int?)GetQueryFilterParameterValue("TermOfPaymentID"),
                (int?)GetQueryFilterParameterValue("PriceGroupID"),
                (int?)GetQueryFilterParameterValue("DiscountGroupID"),
                (string)GetQueryFilterParameterValue("DiscountGroupCode"),
                (string)GetQueryFilterParameterValue("DiscountGroupName"),
                (string)GetQueryFilterParameterValue("DiscountGroupDescription"),
                (int?)GetQueryFilterParameterValue("DiscountGroupStatusID"),
                (bool?)GetQueryFilterParameterValue("IsTaxNumberAvailable"),
                (string)GetQueryFilterParameterValue("TaxNumber"),
                (string)GetQueryFilterParameterValue("Address"),
                (string)GetQueryFilterParameterValue("City"),
                (string)GetQueryFilterParameterValue("StateProvince"),
                (int?)GetQueryFilterParameterValue("CountryID"),
                (string)GetQueryFilterParameterValue("CountryName"),
                (string)GetQueryFilterParameterValue("ZipCode"),
                (string)GetQueryFilterParameterValue("Phone1"),
                (string)GetQueryFilterParameterValue("Phone2"),
                (string)GetQueryFilterParameterValue("Phone3"),
                (string)GetQueryFilterParameterValue("Fax"),
                (string)GetQueryFilterParameterValue("Email"),
                (string)GetQueryFilterParameterValue("AdditionalInfo"),
                (int?)GetQueryFilterParameterValue("CategoryID"),
                (string)GetQueryFilterParameterValue("CategoryCode"),
                (string)GetQueryFilterParameterValue("CategoryName"),
                (int?)GetQueryFilterParameterValue("StatusID"),
                false,
                (Guid?)GetQueryFilterParameterValue("SalesmanIDRoute"),
                (int?)GetQueryFilterParameterValue("WeekIDEqual"),
                (int?)GetQueryFilterParameterValue("DayIDEqual"),
                (int?)GetQueryFilterParameterValue("WeekIDNotEqual"),
                (int?)GetQueryFilterParameterValue("DayIDNotEqual"));
        }

        #endregion

    }

}
